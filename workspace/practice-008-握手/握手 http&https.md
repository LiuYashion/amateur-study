[https学习](https://www.jianshu.com/p/a677fecec927)


# 一个完整的http请求
```js
    - 域名解析 （根据域名搜索ip）
    - 搜索浏览器dns缓存
    - 搜索系统dns缓存
    - 查找hosts文件，看是否有ip映射
    - 先dns服务器发起请求

    - tcp链接（三次握手）
    - 客户端发送请求到服务器，等待服务器确认，客户端进入等待状态
    - 服务器收到，自己也发送一个包给客户端，服务器进入等待状态
    - 客户端收到，并向服务器确认，至此3次握手完毕

    - http请求
    - http请求是一次性链接，每次请求都需要服务器响应
```


# http
http是一个网络应用层的协议，用来传输web内容


### 1）http / tcp
tcp、udp是传输层协议，http的实现需要依赖tcp。http分两种
- 长连接

  如果是“长连接”的方式，浏览器也会先发起一个 TCP 连接去抓取页面。但是抓取页面之后，该 TCP 连接并不会立即关闭，而是暂时先保持着（所谓的“Keep-Alive”）。然后浏览器分析 HTML 源码之后，发现有很多外部资源，就用刚才那个 TCP 连接去抓取此页面的外部资源。

- 短连接

  在“短连接”的模式下，浏览器会先发起一个 TCP 连接，拿到该网页的 HTML 源代码（拿到 HTML 之后，这个 TCP 连接就关闭了）。然后，浏览器开始分析这个网页的源码，知道这个页面包含很多外部资源（图片、CSS、JS）。然后针对【每一个】外部资源，再分别发起一个个 TCP 连接，把这些文件获取到本地（同样的，每抓取一个外部资源后，相应的 TCP 就断开）


### 2）ssl / tls
https在http的传输层之上，增加了的个安全层（SSL、TLS协议实现），可以视作同一个东西的不同阶段。


### http / https区别
- HTTPS协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。
- HTTP是超文本传输协议，信息是明文传输，HTTPS则是具有安全性的SSL加密传输协议。
- HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者使用的端口是80，后者使用的端口是443。
- HTTPS的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比HTTP协议安全。


### 握手挥手
握手阶段的信息都是明文的

- 1）客户端发出请求

    - 客户端生成的随机数A，稍后用于生成"对话密钥"。
    - 支持的协议版本
    - 支持的加密方法
    - 支持的压缩方法

- 2）服务器响应：

    - 服务器生成的随机数B，稍后用于生成"对话密钥"。
    - 确认使用的协议版本
    - 确认使用的加密方法
    - 服务器证书

- 3）客户端回应：

    - 客户端生成的随机数C，稍后用于生成"对话密钥"。
    - 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
    - 客户端握手结束通知，并附加所有内容的hash值防止被篡改

- 4）客户端回应：

    - 编码改变通知，随后双方都是用协定的加密方法和秘钥通知
    - 服务端握手结束通知，并附加所有内容的hash值防止被篡改

至此三次握手，四次挥手完成。接下来服务端与客户端之间的通信就是普通的http协议，只不过是用“会话秘钥”来加密内容。这个会话秘钥是三个随机数通过开始的加密方法生成的。



# QUIC
QUIC（quick udp internet connection）即为快速UDP互联网连接，是由google提出的使用UDP进行多路并发传输的协议



### 现状
至今为止，大部分互联网流量传输协议只使用了几个网络协议（ipv4进行路由，tcp进行连接，SSL/TSL传输安全，DNS解析，HTTP传输），然而这些协议的发展都很缓慢。tcp主要是拥塞算法的改进，ipv4虽然升级到了ipv6，但是部署的进度十分缓慢



### 那么问题来了
网络交互越来越丰富，传输内容越来越大，很多问题凸显了出来
- 中间设备僵化
  
  TCP协议使用太久，导致形成了一些约定俗成的操作：防火墙只允许80和443端口通过，NAT网关在转换网络地址时重写传输层的头部等等

- 依赖操作系统导致的协议僵化

  windowXP任然有大部分用户在使用，所以导致系统升级滞后。比如TCP Fast Open，虽然2013年就被提出来了，但是windows很多版本都不支持它

- 建立连接的握手延迟大

  http、https系列都使用了tcp进行传输。tcp三次握手导致的延迟

- 队头阻塞

  队头阻塞是TCP协议的可靠性机制引入的，TCP是使用序列号来标识数据顺序的，如果前面数据丢失，后面数据就算到达了也不会处理，TSL类似，丢失了数据也会导致整个record无法正确处理，所以在现有的TCP，TSL之上再实现新的应用层协议，阻力是很大的

### 有好的方案吗？
所以QUIC使用了UDP协议，ORTT连接。没有握手，所以也就没有握手延迟。然后在应用程序面实现了TCP的可靠性，TLS的安全性，HTTP2的并发性，只要用户端和服务端的应用程序支持QUIC程序，就能完全避开操作系统和中间设备的限制



### QUIC的改进

- 减少了TCP三次握手与TSL握手时间
- 改进了的拥塞机制
- 避免队头阻塞的多路复用
- 连接迁移
- 向前冗余纠错

